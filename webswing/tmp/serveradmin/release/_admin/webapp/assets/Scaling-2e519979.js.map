{"version":3,"file":"Scaling-2e519979.js","sources":["../../src/views/Overview/partials/ScalingFormiumConfig.tsx","../../src/views/Overview/Scaling.tsx"],"sourcesContent":["// core\nimport React from 'react'\nimport Formium from 'formium-component';\n// services\nimport { ScalingService } from '@/services';\n\n// components\nimport { IComponentProps } from '@/components'\n\n// styles\nimport { MetaObject, ResolveScalingTypeEnum, SearchScalingVariablesTypeEnum } from '@/gen';\nimport { store } from '@/stores';\nimport css from './ScalingFormiumConfig.module.scss';\nimport { escapeHtml } from '@/utils';\n\nexport interface IScalingFormiumConfigProps extends IComponentProps {\n    identify: string,\n    value?: MetaObject,\n    list?: { [key: string]: MetaObject; },\n    variables?: string[],\n    readonly: boolean,\n    hide?: string[]\n    onConfigChange?: any\n    translations?: any\n    lang?: string\n}\n\nexport default class ScalingFormiumConfig extends React.Component<IScalingFormiumConfigProps> {\n    private formiumRef = React.createRef<HTMLDivElement>();\n    private form: Formium | undefined;\n\n    constructor(props: IScalingFormiumConfigProps) {\n        super(props);\n    }\n\n    componentDidMount() {\n        setTimeout(() => {\n            this.form = new Formium({\n                \"target\": this.formiumRef.current as HTMLElement,\n                \"props\": {\n                    \"value\": this.props.value,\n                    \"list\": this.props.list,\n                    \"readonly\": this.props.readonly,\n                    \"identify\": this.props.identify,\n                    \"hiddenConfigFields\": this.props.hide || [],\n                    \"translations\": this.props.translations,\n                    \"lang\": this.props.lang\n                }\n            });\n\n            this.form.$on('requestUpdate', (event: any) => {\n                store.scalingStore.onRequestUpdate();\n            });\n\n            this.form.$on('configChange', (event: any) => {\n                store.scalingStore.compareConfig();\n            });\n\n            this.form.$set({\n                onVariableSearch: (variables: SearchScalingVariablesTypeEnum, valToSearch: string) => {\n                    const val = valToSearch;\n                    const cleanVal = val.substr(val.lastIndexOf('$'), val.length);\n                    const searchSeq = cleanVal.substr(0, 0) + cleanVal.substr(0 + 2);\n                    return ScalingService.getVariables(variables, searchSeq).then((data: any) => {\n                        return data;\n                    });\n                }\n            });\n\n            this.form.$set({\n                onVariableResolve: (variables: ResolveScalingTypeEnum, valueToResolve: string) => {\n                    const val = valueToResolve;\n                    return ScalingService.resolveVariable(variables, val).then((data) => {\n                        let result = '';\n\n                        if (!data || data === null) {\n                            return result;\n                        }\n\n                        const multiVar = Object.keys(data).length > 1;\n                        if (multiVar) {\n                            result += '<ul class=\"var-res-list\">'\n                            for (const property in data) {\n                                result += '<li>' + escapeHtml(property) + '</li>';\n                            }\n                            result += '</ul>'\n                        } else {\n                            result += escapeHtml(Object.keys(data)[0]);\n                        }\n                        return result;\n                    });\n                }\n            });\n        }, 10);\n    }\n\n    componentDidUpdate(prevProps: IScalingFormiumConfigProps) {\n        this.form?.$set({\n            readonly: this.props.readonly,\n            value: this.props.value,\n            list: this.props.list,\n            identify: this.props.identify,\n            hide: this.props.hide,\n            translations: this.props.translations,\n            lang: this.props.lang\n        })\n    }\n\n    componentWillUnmount() {\n        if (this.form) {\n            this.form.$destroy()\n        }\n    }\n\n    render() {\n        return <div className={css.root} id={this.props.identify} ref={this.formiumRef} />\n    }\n}","import { useCallback, useEffect, useState } from 'react';\nimport cx from 'classnames';\nimport { changeTitle } from '../routes';\nimport css from './Scaling.module.scss'\nimport { useStore } from '@/stores';\nimport { observer } from 'mobx-react';\nimport { ButtonGroup } from '@/components/basic/Button/variants/ButtonGroup/ButtonGroup';\nimport { useTranslation } from 'react-i18next';\nimport ScalingFormiumConfig from './partials/ScalingFormiumConfig';\nimport { ButtonIcon, Flex } from '@/components';\nimport { LogsTable } from '@/views/LogsView/partial/LogsTable';\n\nconst Scaling = observer(() => {\n  const { permissionsStore, globalStore, scalingStore, logsStore } = useStore();\n  const [tab, setTab] = useState<'logs' | 'config'>('logs');\n  const { t, i18n } = useTranslation();\n\n  useEffect(() => {\n    scalingStore.loadConfig();\n    globalStore.updateApp('');\n    \n    changeTab(tab);\n\n    return () => {\n      scalingStore.clearConfigData();\n    }\n  }, []);\n\n  const changeTab = useCallback((tab: 'logs' | 'config') => {\n    setTab(tab);\n    if (tab === 'logs') {\n      logsStore.refresh('/', 'scaling');\n    } else {\n      logsStore.clearInterval();\n    }\n  }, [setTab])\n\n  changeTitle(i18n.t('routes.scaling'));\n\n  return (\n    <>\n      <Flex className={css.headerRow} justifyContent=\"space-between\" alignItems=\"center\">\n        <Flex className={css.btnstab}> \n          <ButtonIcon\n              className={css.rightSpace}\n              icon='list' \n              active={'logs' === tab} \n              onClick={() => changeTab('logs')}\n              >\n              {t('scaling.logs')}\n          </ButtonIcon>\n          <ButtonIcon \n              className={css.rightSpace}\n              icon='timer' \n              active={'config' === tab} \n              onClick={() => changeTab('config')}\n              >\n              {t('scaling.config')}\n          </ButtonIcon>\n        </Flex>\n      </Flex>\n      {\n        (tab === 'logs') && <>\n          <LogsTable className={css.tableHeight} type={'scaling'} app={'/'} />\n        </>\n      }\n      {\n        (tab === 'config') && <>\n          <ScalingFormiumConfig\n            readonly={!permissionsStore.get('configEdit')}\n            identify={'scalingConfig'}\n            value={scalingStore.config}\n            translations={i18n.getDataByLanguage(i18n.language)?.translation}\n            lang={i18n.language}\n          />\n          <ButtonGroup\n            className={cx(css.floatingButtons, { [css.activeApply]: scalingStore.activeApply })}\n            buttons={\n              [\n                { label: i18n.t('Apply'), size: 'small', color: 'blue', onClick: () => scalingStore.setConfig() },\n                { label: i18n.t('Reset'), size: 'small', color: 'white', onClick: () => scalingStore.resetConfig() }\n              ]\n            }\n          />\n        </>\n      }\n    </>\n  )\n})\n\nexport default Scaling"],"names":["ScalingFormiumConfig","React","props","__publicField","Formium","event","store","variables","valToSearch","val","cleanVal","searchSeq","ScalingService","data","valueToResolve","result","property","escapeHtml","prevProps","_a","jsx","css","Scaling","observer","permissionsStore","globalStore","scalingStore","logsStore","useStore","tab","setTab","useState","t","i18n","useTranslation","useEffect","changeTab","useCallback","changeTitle","jsxs","Fragment","Flex","ButtonIcon","LogsTable","ButtonGroup","cx"],"mappings":"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"}