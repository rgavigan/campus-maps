import{r as p,j as s,c as C,u as S,s as I,o as N,H as k,i as U}from"./vendor-95b30d29.js";import{o as w,F as g,i as l,u as j,I as M,d as E,W as V,p as z,_ as R,h as K,q as D,r as F,U as L,s as v,t as B,C as H,e as X,j as G,B as y,n as W,P as O,m as $,T as q,k as J,g as Q,v as Y,R as Z,w as ss}from"./index-61e14e01.js";import{A}from"./AvatarWithTitle-90e4e708.js";const f=({color:t,label:e,children:r,now:n,min:o=0,max:d=100,className:m,onClick:c})=>{const[a,i]=p.useState(0),h=(b,T,P)=>{const _=(b-T)/(P-T)*100;return Math.round(_*1e3)/1e3};return p.useEffect(()=>{i(h(n,o,d))},[n,o,d]),s.jsxs("div",{className:C(w.root,m),children:[s.jsx("div",{className:C(w.progress,w[t]),style:{width:`${a}%`}}),s.jsx("div",{className:w.content,children:r||n})]})},es=({session:t})=>{var r,n,o,d,m,c,u,a;const{t:e}=S();return s.jsxs(g,{flexWrap:"nowrap",spacing:5,alignItems:"center",className:l.MetricsCellChild,children:[s.jsxs(g,{bColumn:!0,spacing:1,flex:1,justifyContent:"center",children:[s.jsx("h4",{children:e("sessions.default")}),s.jsxs(f,{color:"primary",max:(r=t.metrics)==null?void 0:r.memoryAllocated,now:(n=t.metrics)==null?void 0:n.memoryUsed,children:[s.jsx("span",{children:"MEM: "+(((o=t.metrics)==null?void 0:o.memoryUsed)||0)+"MB"}),s.jsxs("small",{children:["(",t.metrics["memoryUsed.MIN"]||0,"|",t.metrics["memoryUsed.AVG"]||0,"|",t.metrics["memoryUsed.MAX"]||0,")"]})]}),s.jsxs(f,{color:"success",now:(d=t.metrics)==null?void 0:d.cpuUtilization,children:["CPU: "+(((m=t.metrics)==null?void 0:m.cpuUtilization)||0)+"% ",s.jsxs("small",{children:["(",t.metrics["cpuUtilization.MIN"]||0,"|",t.metrics["cpuUtilization.AVG"]||0,"|",t.metrics["cpuUtilization.MAX"]||0,")"]})]})]}),s.jsxs(g,{bColumn:!0,spacing:1,flex:1,justifyContent:"center",children:[s.jsx("h4",{children:e("sessions.bandwidth")}),s.jsxs(f,{color:"success",max:102400,now:(c=t.metrics)==null?void 0:c.inboundSize,children:["IN: "+Math.round(t.metrics.inboundSize/1024||0)+"k/s",s.jsxs("small",{children:["(",Math.round(t.metrics["inboundSize.MIN"]/1024),"|",Math.round(t.metrics["inboundSize.AVG"]/1024),"|",Math.round(t.metrics["inboundSize.MAX"]/1024),")"]})]}),s.jsxs(f,{color:"primary",max:102400,now:(u=t.metrics)==null?void 0:u.outboundSize,children:["OUT: "+Math.round(t.metrics.outboundSize/1024)+"k/s",s.jsxs("small",{children:["(",Math.round(t.metrics["outboundSize.MIN"]/1024),"|",Math.round(t.metrics["outboundSize.AVG"]/1024),"|",Math.round(t.metrics["outboundSize.MAX"]/1024),")"]})]})]}),s.jsxs(g,{bColumn:!0,spacing:1,flex:1,justifyContent:"center",children:[s.jsx("h4",{children:e("sessions.latency")}),s.jsxs(f,{color:"danger",max:700,now:t.metrics.latency,children:["E2E: "+(t.metrics.latency||0)+"ms",s.jsxs("small",{children:["(",t.metrics["latency.MIN"]||0,"|",t.metrics["latency.AVG"]||0,"|",t.metrics["latency.MAX"]||0,")"]})]}),s.jsxs(f,{color:"danger",max:500,now:(a=t.metrics)==null?void 0:a.latencyPing,children:["PING: "+(t.metrics.latencyPing||0)+"ms",s.jsxs("small",{children:["(",t.metrics["latencyPing.MIN"]||0,"|",t.metrics["latencyPing.AVG"]||0,"|",t.metrics["latencyPing.MAX"]||0,")"]})]})]})]})},ts=({session:t,bFinished:e=!1})=>{const{sessionsStore:r}=j(),n=I(),{t:o}=S(),[d,m]=p.useState(!1),c=u=>{r.getWarningsNum(u)&&!e&&(n.push("/sessions"+u.applicationPath+"/"+u.id,{previous:n.location.pathname}),r.setActiveTab("warnings")),r.getWarningsNum(u)&&e&&m(a=>!a)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:C(l.Cell,l.warningsCell,{[l.has]:r.getWarningsNum(t)}),onClick:()=>c(t),children:[s.jsx(M,{name:"warning"}),r.getWarningsNum(t)?o("sessions.warningWithCount",{count:r.getWarningsNum(t)}):o("sessions.noWarnings")]}),s.jsx(E,{bOpen:d,title:o("sessions.warning_plural"),onToggle:u=>m(u),footer:!1,children:s.jsx(V,{session:t})})]})},as=N(({cols:t,isMetricColVisible:e})=>{const r=I(),{sessionsStore:n}=j(),[o,d]=p.useState(window.innerWidth),m=n.sessionsTab,c=p.useCallback(h=>{r.push("/sessions"+h.rowData.applicationPath+"/"+h.rowData.id,{previous:r.location.pathname}),n.setActiveTab("view")},[r,m]);z(),p.useEffect(()=>(window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u)}),[]);const u=R(()=>d(window.innerWidth)),a=n.filteredSessionsList;let i=20;return t.forEach(h=>{h.isVisible&&(i+=h.minWidth||0)}),s.jsx("div",{style:{overflowX:"auto"},children:s.jsx(K,{collection:a,minTableWidth:i,rowHeight:e?100:60,rowClassName:l.ac,threshold:500,columns:m==="sessions"?t==null?void 0:t.filter(h=>n.visibleColumns.includes(h.dataKey)):t,onRowDoubleClick:c,onRowRightClick:c,className:C(l.tableHeight,l.vTable)},o)})}),ns=(t,e)=>{const[r,n]=p.useState([]),{sessionsStore:o}=j(),d=[{dataKey:"applicationPath",label:"",align:"start",minWidth:35,width:35,className:l.actionCell,component:(a,i)=>s.jsx(D,{session:i})},{dataKey:"application",label:e("sessions.app"),minWidth:200,align:"start",bSort:!0,className:C(l.defaultCell,l.gridAppCell),component:(a,i)=>s.jsx(F,{session:i})},{dataKey:"user",label:e("logs.user"),minWidth:100,align:"start",bSort:!0,component:(a,i)=>s.jsx(L,{session:i})},{dataKey:"userIp",label:e("logs.ip"),minWidth:100,align:"start",className:l.defaultCell},{dataKey:"startedAt",label:e("sessions.startTime"),minWidth:140,align:"start",bSort:!0,component:a=>s.jsx("div",{className:l.Cell,children:v(Number(a))})}],m={dataKey:"connected",label:e("general.status"),align:"start",minWidth:115,bSort:!0,component:(a,i)=>s.jsx(B,{session:i})},c={dataKey:"warnings",label:e("sessions.warning_plural"),align:"start",minWidth:160,bSort:!0,component:(a,i)=>s.jsx(ts,{session:i,bFinished:t!=="sessions"})},u=p.useCallback(()=>{const a=[...d];switch(t){case"sessions":{a.push(m),a.push(c),a.push({dataKey:"metrics",label:e("sessions.metrics"),align:"start",minWidth:500,className:l.actionCell,component:(i,h)=>s.jsx(es,{session:h})},{dataKey:"sessionPoolId",label:e("sessions.spId"),minWidth:278,align:"start",className:l.defaultCell},{dataKey:"pid",label:e("sessions.processId"),minWidth:100,align:"start",className:l.defaultCell},{dataKey:"id",label:e("sessions.instanceId"),minWidth:340,align:"start",className:l.defaultCell}),a.forEach(i=>{i.isVisible=!!o.visibleColumns.includes(i.dataKey)});break}case"closedSessions":{a.push({dataKey:"endedAt",label:e("sessions.endTime"),align:"start",minWidth:140,bSort:!0,isVisible:!0,component:i=>s.jsx("div",{className:l.Cell,children:v(Number(i))})}),a.push(m),a.push(c);break}}n(a)},[d,t]);return p.useEffect(()=>{u()},[t]),[r,a=>n(a)]},is="_root_11cg0_1",ls="_AvatarCol_11cg0_5",rs="_smCol_11cg0_9",os="_label_11cg0_15",x={root:is,AvatarCol:ls,smCol:rs,label:os},cs=N(function({app:e,className:r,onClick:n}){var a,i,h,b;const{globalStore:o,sessionsStore:d}=j(),m=d.sessions,c=(a=o.paths)==null?void 0:a.find(T=>T.path===`/${e}`),{t:u}=S();return s.jsx(H,{className:C(x.root,r),onClick:n,children:s.jsxs(g,{style:{padding:"0 1rem"},children:[s.jsx(g,{bColumn:!0,className:x.AvatarCol,flex:2,children:c?s.jsx(s.Fragment,{children:s.jsx(A,{size:"medium",src:X+"/"+e+"/rest/appicon",title:c==null?void 0:c.name})}):s.jsx(A,{size:"medium",icon:"apps",title:"All Sessions"})}),c!==void 0&&s.jsxs(s.Fragment,{children:[s.jsxs(g,{bColumn:!0,flex:1,className:x.smCol,justifyContent:"center",children:[s.jsxs("span",{className:x.label,children:[u("general.status"),":"]}),s.jsx(G,{status:c==null?void 0:c.status,loadMessage:""})]}),s.jsxs(g,{bColumn:!0,flex:1,className:x.smCol,justifyContent:"center",children:[s.jsxs("span",{className:x.label,children:[u("apps.path"),":"]}),s.jsx("a",{href:c==null?void 0:c.url,target:"_blank",rel:"noreferrer",children:c==null?void 0:c.path})]})]}),s.jsxs(g,{bColumn:!0,flex:1,className:x.smCol,justifyContent:"center",children:[s.jsxs("span",{className:x.label,children:[u("status.running"),":"]}),(i=m.sessions)==null?void 0:i.length]}),s.jsxs(g,{bColumn:!0,flex:1,className:x.smCol,justifyContent:"center",children:[s.jsxs("span",{className:x.label,children:[u("status.idle"),":"]}),(h=m.idle)==null?void 0:h.length]}),s.jsxs(g,{bColumn:!0,flex:1,className:x.smCol,justifyContent:"center",children:[s.jsxs("span",{className:x.label,children:[u("status.finished"),":"]}),(b=m.closedSessions)==null?void 0:b.length]})]})})}),ds=N(({onChangeTab:t,tab:e})=>{const{permissionsStore:r,sessionsStore:n}=j(),{app:o}=k(),{t:d}=S(),m=c=>{t(c)};return s.jsxs(g,{className:l.btnstab,children:[n.shouldShowIdle()&&s.jsx(y,{className:l.rightSpace,icon:"hourglass_empty",active:e==="idleSessions",onClick:()=>m("idleSessions"),children:d("status.idle")}),s.jsx(y,{className:l.rightSpace,icon:"check",active:e==="sessions",onClick:()=>m("sessions"),children:d("status.running")}),s.jsx(y,{className:l.rightSpace,icon:"timer",active:e==="closedSessions",onClick:()=>m("closedSessions"),children:d("status.finished")}),o&&r.get("playbackRecording")&&s.jsx(y,{className:l.rightSpace,icon:"videocam",active:e==="recordings",onClick:()=>m("recordings"),children:d("sessions.tab.recordings")}),o&&r.get("getThreadDump")&&s.jsx(y,{className:l.rightSpace,icon:"view_list",active:e==="threadDumps",onClick:()=>m("threadDumps"),children:d("sessions.tab.threadDumps")})]})}),ms=N(({columns:t,onColumnVisibilityChange:e})=>{const[r,n]=p.useState(!1);return s.jsxs("div",{title:"Choose column",className:l.colSelector,children:[s.jsx(W,{color:"neutral",icon:"view_week",onClick:()=>n(o=>!o)}),s.jsx(O,{darkBP:!0,backdrop:!0,width:240,className:C(l.selPopover),open:r,side:"right",onBlur:()=>n(o=>!o),children:s.jsx(g,{bColumn:!0,spacing:2,justifyContent:"center",style:{margin:"1rem"},children:t.map((o,d)=>s.jsx(p.Fragment,{children:o.label&&s.jsx($,{disabled:o.label==="Application",value:o.isVisible,onClick:()=>e(String(o.dataKey)),children:s.jsx("span",{style:{cursor:"pointer"},onClick:()=>{o.label!=="Application"&&e(String(o.dataKey))},children:o.label})})},d))})})]})}),us=N(({app:t})=>{var u;const{sessionsStore:e}=j(),{t:r}=S(),[n,o]=p.useState([]),d=[{dataKey:"application",label:r("sessions.app"),align:"start",width:300,className:l.defaultCell},{dataKey:"id",label:r("sessions.instanceId"),minWidth:400,align:"start",className:l.defaultCell,component:a=>s.jsx(q,{content:r("sessions.instance")+" "+r("sessions.id")+": "+a,children:s.jsx("span",{children:a})})},{dataKey:"sessionPoolId",label:r("sessions.spId"),minWidth:280,align:"start",className:l.defaultCell},{dataKey:"startedAt",label:r("sessions.startTime"),minWidth:135,align:"start",bSort:!0,component:a=>s.jsx("div",{className:l.Cell,children:v(Number(a))})}],m=p.useCallback(()=>{o([...d])},[d]);z(),p.useEffect(()=>{m()},[]);const c=e.searchTerm?(u=e.sessions.idle)==null?void 0:u.filter(a=>{var i,h;return((i=a.application)==null?void 0:i.toLowerCase().includes(e.searchTerm.toLocaleLowerCase()))||((h=a.id)==null?void 0:h.toLowerCase().includes(e.searchTerm.toLocaleLowerCase()))}):e.sessions.idle;return s.jsx("div",{style:{overflowX:"auto"},children:s.jsx(K,{collection:c,minTableWidth:1055,rowHeight:60,rowClassName:l.ac,threshold:500,columns:n,className:C(l.tableHeight,l.vTable)})})}),bs=N(()=>{const{globalStore:t,sessionsStore:e,permissionsStore:r}=j(),{app:n}=k(),{t:o}=S(),[d,m]=ns(e.sessionsTab,o),c=i=>{const h=d.map(b=>b.dataKey===i?{...b,isVisible:!b.isVisible}:b);e.setVisibleColumns(h.filter(b=>b.isVisible).map(b=>b.dataKey)),m(h)},u=p.useCallback(i=>{e.setSessionsTab(i),i==="closedSessions"&&e.setExtendTableToggle(!1)},[e.setSessionsTab]),a=i=>{e.setSearchTerm(i.target.value)};return p.useEffect(()=>(!n&&(e.sessionsTab==="recordings"||e.sessionsTab==="threadDumps")&&e.setSessionsTab("sessions"),t.updateApp(n),e.setAppPath(n),e.refresh(),()=>e.clearInterval()),[n,e.sessionsTab]),J(U.t("routes.sessions")),s.jsxs("div",{className:l.root,children:[s.jsx(cs,{app:n}),s.jsxs(g,{className:l.headerRow,justifyContent:"space-between",alignItems:"center",children:[s.jsx(ds,{tab:e.sessionsTab,onChangeTab:u}),s.jsxs(g,{spacing:3,children:[s.jsxs(W.UI,{color:"neutral",className:C(Q.wTab,l.refresh),onClick:()=>e.refresh(),children:[s.jsx(M,{size:"small",name:"cached"})," ",e.lastUpdated]}),!e.filterToggle&&s.jsx(W,{color:"neutral",icon:"search",onClick:()=>e.setFilterToggle()}),e.filterToggle&&s.jsx(Y,{inputClassName:l.inputHeight,value:e.searchTerm,onChange:a,onClose:()=>e.setFilterToggle()}),e.sessionsTab==="sessions"&&s.jsx(ms,{columns:d,onColumnVisibilityChange:c})]})]}),(e.sessionsTab==="sessions"||e.sessionsTab==="closedSessions")&&s.jsx(as,{cols:d,app:n,isMetricColVisible:d.some(i=>i.dataKey==="metrics"&&i.isVisible)}),e.sessionsTab==="idleSessions"&&s.jsx(us,{app:n}),e.sessionsTab==="recordings"&&r.get("playbackRecording")&&s.jsx(Z,{app:n}),e.sessionsTab==="threadDumps"&&r.get("getThreadDump")&&s.jsx(ss,{app:n})]})});export{bs as default};
//# sourceMappingURL=Sessions-6f9d2d5e.js.map
